<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 1 Assessment Test (Part 2)</title>
    <link rel="stylesheet" href="../assets/styles/test-style.css">
    <style>
    .complete-button:disabled {
        background-color: #ccc !important;
        color: #888 !important;
        cursor: not-allowed;
        opacity: 0.7;
        border: 1px solid #aaa;
    }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Day 1 Assessment Test (Part 2)</h1>
        <form id="testForm">
            <div class="question">
                <p>What should you do when another vehicle is following you too close? (Ano ang gagawin mo kung ang sumusunod na sasakyan sa iyo ay masyadong nakatutok?)</p>
                <label><input type="radio" name="q1" value="a"> a. Speed up to start a road race (Bilisan pa ang takbo at makipagkarerahan)</label><br>
                <label><input type="radio" name="q1" value="b" data-correct="true"> b. Slow down gradually and give him the signal to overtake you (Unti-unti mong bagalan ang takbo at senyasan siyang mag-overtake)</label><br>
                <label><input type="radio" name="q1" value="c"> c. Slam on your brakes (Biglang magpreno)</label><br>
            </div>
            <div class="question">
                <p>Before changing lanes in traffic, aside from giving signal and checking your side and rearview mirrors, what else do you need to do? (Bago lumipat ng lane, bukod sa dapat munang sumenyas, tumingin sa mga gilid at rear view mirror, ano pa ang dapat mong gawin?)</p>
                <label><input type="radio" name="q2" value="a" data-correct="true"> a. Turn your head to check other vehicles beside your car (Tingnan ang mga katabing sasakyan)</label><br>
                <label><input type="radio" name="q2" value="b"> b. Sound your horn (Bumusina)</label><br>
                <label><input type="radio" name="q2" value="c"> c. Blink your headlights (Pailawin ang mga headlights)</label><br>
            </div>
            <div class="question">
                <p>When approaching a sharp curve of the highway, you should: (Kapag papalapit sa isang biglaang pagliko/kurbada, dapat:)</p>
                <label><input type="radio" name="q3" value="a" data-correct="true"> a. reduce speed before entering the curve (bagalan ang takbo bago lumiko)</label><br>
                <label><input type="radio" name="q3" value="b"> b. increase speed while negotiating the curve (bilisan ang takbo habang lumiliko)</label><br>
                <label><input type="radio" name="q3" value="c"> c. apply your brakes abruptly while taking the curve (biglang magpreno habang lumiliko)</label><br>
            </div>
            <div class="question">
                <p>Night driving is difficult. We should do the following when a vehicle comes towards us at night: (Mahirap magmaneho kung gabi kaya dapat gawin ang sumusunod kapag may kasalubong na sasakyan:)</p>
                <label><input type="radio" name="q4" value="a" data-correct="true"> a. dim your lights by switching to low beam (hinaan ang ilaw sa pamamagitan ng pagsindi sa low beam)</label><br>
                <label><input type="radio" name="q4" value="b"> b. brighten your light by switching to high beam (lakasan ang ilaw sa pamamagitan ng pagsindi sa high beam)</label><br>
                <label><input type="radio" name="q4" value="c"> c. switch on your headlights intermittently (sindihan ang mga headlight, on and off)</label><br>
            </div>
            <div class="question">
                <p>At night, when approaching a curve or intersection with poor visibility, be sure to: (Sa gabi, kapag papalapit sa isang kurbada o interseksiyon na mahirap makita ang kasalubong, siguraduhing:)</p>
                <label><input type="radio" name="q5" value="a"> a. switch off your headlights to enable oncoming motorists to see you (patayin ang headlight upang makita ng mga motorista ang iyong sasakyan)</label><br>
                <label><input type="radio" name="q5" value="b" data-correct="true"> b. flash your headlights to let pedestrians and oncoming motorists know that you are heading into the curve or intersection (sumenyas sa pamamagitan ng pagpatay-sindi ng headlight upang malaman ng mga tao at mga kasalubong na motorista na papalapit ka sa kurbada o interseksiyon)</label><br>
                <label><input type="radio" name="q5" value="c"> c. switch on your interior lights to enable oncoming vehicles to see your vehicle (i-switch ang mga ilaw sa loob ng sasakyan upang makita ng mga makakasalubong ang iyong sasakyan)</label><br>
            </div>
            <div class="question">
                <p>What is the best safety rule when driving a motor vehicle? (Ano ang pinakaligtas na alituntunin habang ikaw ay nagmamaneho?)</p>
                <label><input type="radio" name="q6" value="a" data-correct="true"> a. Never insist on your right-of-way (Huwag ipilit ang karapatan sa daan)</label><br>
                <label><input type="radio" name="q6" value="b"> b. Blow your horn to assert your right-of-way (Bumusina upang maigiit ang iyong karapatan sa daan)</label><br>
                <label><input type="radio" name="q6" value="c"> c. Always demand for the right-of-way (laging igiit ang karapatan sa daan)</label><br>
            </div>
            <div class="question">
                <p>A blind spot is either at your right or left that you do not see on your side mirror. What should you do before backing-up? (Ang blind spot ay nasa awing kanan o kaliwa na hindi mo nakikita sa iyong side mirror. Ano ang dapat mong gawin bago umatras?)</p>
                <label><input type="radio" name="q7" value="a" data-correct="true"> a. Turn your head to see that the way is clear (Lumingon upang matiyak na walang nakaharang sa daan)</label><br>
                <label><input type="radio" name="q7" value="b"> b. Turn your wheel all the way to the right and pull up (Ipaling nang sagad ang gulong sa kanan bago huminto)</label><br>
                <label><input type="radio" name="q7" value="c"> c. Turn your wheel all the way to the left and pull up (Ipaling nang sagad ang gulong sa kaliwa bago huminto)</label><br>
            </div>
            <div class="question">
                <p>Road crash can be avoided if the drivers: (Maiiwasan ang mga road crash kung:)</p>
                <label><input type="radio" name="q8" value="a" data-correct="true"> a. follow traffic signs and pertinent traffic rules and regulations (susundin ang mga senyas pantrapiko at mga alintuntunin at regulasyon ng batas trapiko)</label><br>
                <label><input type="radio" name="q8" value="b"> b. totally disobey traffic laws (ganap na hindi susundin ang mga batas trapiko)</label><br>
                <label><input type="radio" name="q8" value="c"> c. are ignorant of traffic laws (ang mga drayber ay walang alam sa batas trapiko)</label><br>
            </div>
            <div class="question">
                <p>What should you do whenever you are driving on a highway with a lot of potholes? (Ano ang dapat mong gawin kapag nagmamaneho sa highway na maraming lubak?)</p>
                <label><input type="radio" name="q9" value="a"> a. Increase speed (Bilisan ang takbo)</label><br>
                <label><input type="radio" name="q9" value="b" data-correct="true"> b. Reduce speed (Bagalan ang takbo)</label><br>
                <label><input type="radio" name="q9" value="c"> c. Always change lane (Palaging lumipat ng lane)</label><br>
            </div>
            <div class="question">
                <p>Sometimes, a driver passes through a busy street with so many pedestrians. Which of the following should a driver do? (Kung minsan, dumaraan ang drayber sa isang kalye na maraming sasakyan at maraming tao. Alin sa mga sumusunod ang dapat niyang gawin?)</p>
                <label><input type="radio" name="q10" value="a" data-correct="true"> a. Slowdown and check for safety when passing through (Bagalan ang takbo at tingnan kung ligtas ang pagdaan)</label><br>
                <label><input type="radio" name="q10" value="b"> b. Proceed with usual speed (Magpatuloy sa normal na takbo)</label><br>
                <label><input type="radio" name="q10" value="c"> c. Stop at all cost (Huminto anuman ang mangyari)</label><br>
            </div>
            <div class="question">
                <p>Driving in heavy rains can be extremely dangerous due to limited visibility. What should you do? (Ang pagmamaneho kapag malakas ang ulan ay lubhang mapanganib dahil hindi makakakita ng maigi. Ano ang dapat mong gawin?)</p>
                <label><input type="radio" name="q11" value="a"> a. When you cannot see more than 20 meters in front of you, turn on your hazard lights / headlights and look for a safe place to park (Kapag hindi makakita nang mahigit sa 20 metro sa harapan mo, i-switch ang hazard lights / headlight at maghanap ng ligtas na mapaparadahan)</label><br>
                <label><input type="radio" name="q11" value="b" data-correct="true"> b. Turn on your headlights and slow down or park at a safe place if situation is risky (I-switch ang headlights at bagalan ang takbo o di kaya naman ay huminto sa isang ligtas na lugar kung ang sitwasyon ay mapanganib)</label><br>
                <label><input type="radio" name="q11" value="c"> c. Turn on your hazard lights, blow your horn and continue driving (I-switch ang hazard lights, bumusina at magpatuloy sa pagmamaneho)</label><br>
            </div>
            <div class="question">
                <p>If you see a ball coming from behind a parked vehicle, it is more likely that a kid is following it. What will you do? (Kung may nakita kang bola na mula sa likuran ng isang nakaparadang sasakyan sa isang kalye, malamang na may batang sumusunod ditto. Ano ang gagawin mo?)</p>
                <label><input type="radio" name="q12" value="a"> a. Increase your speed (Bilisan ang takbo)</label><br>
                <label><input type="radio" name="q12" value="b" data-correct="true"> b. Slow down (Bagalan ang takbo)</label><br>
                <label><input type="radio" name="q12" value="c"> c. Blow your horn and maintain your speed (Bumusina at panatilihin ang bilis ng takbo)</label><br>
            </div>
            <div class="question">
                <p>What should do when you see a traffic sign "ACCIDENT PRONE AREA"? (Ano ang dapat mong gawin kung nakakita ka ng senyas trapiko na nagsasabing "ACCIDENT PRONE AREA"?)</p>
                <label><input type="radio" name="q13" value="a" data-correct="true"> a. Slow down and be more alert than usual (Bagalan ang takbo at higit na maging alisto)</label><br>
                <label><input type="radio" name="q13" value="b"> b. Increase your speed (Bilisan ang takbo)</label><br>
                <label><input type="radio" name="q13" value="c"> c. Blow your horn and resume your normal speed (Bumusina at panatilihin ang normal mong bilis)</label><br>
            </div>
            <div class="question">
                <p>Which of the following is not a safe place to overtake? (Alin sa mga sumusunod ang hindi ligtas na lugar sa pag-overtake/paglusot?)</p>
                <label><input type="radio" name="q14" value="a"> a. When approaching a crest or upon a curve (Kapag papalapit sa paahon na lugar o kurbada)</label><br>
                <label><input type="radio" name="q14" value="b"> b. At an intersection (Sa interseksyon)</label><br>
                <label><input type="radio" name="q14" value="c" data-correct="true"> c. All of the answers (Lahat ng sagot)</label><br>
            </div>
            <div class="question">
                <p>Disregarding traffic lights during late hours of the night could: (Ang pagwawalang-bahala sa mga ilaw trapiko kapag gabi na ay:)</p>
                <label><input type="radio" name="q15" value="a"> a. make you a good driver (makatutulong upang higit kang maging magaling na drayber)</label><br>
                <label><input type="radio" name="q15" value="b" data-correct="true"> b. involve you in a fatal road crash (maaari kang maaksidente at mamatay)</label><br>
                <label><input type="radio" name="q15" value="c"> c. decrease your fuel consumption (makatitipid sa konsumo ng gasolina o krudo)</label><br>
            </div>
            <div class="question">
                <p>A good driver must meet one's social responsibilities of caring for others by: (Ang maayos na drayber ay matutugunan ang responsabilidad sa lipunan sa pamamagitan nang:)</p>
                <label><input type="radio" name="q16" value="a"> a. driving noisily to attract the attention of residents along the road (pagmaneho nang maingay upang mapansin ng mga nadadaanang residente)</label><br>
                <label><input type="radio" name="q16" value="b" data-correct="true"> b. exercising care for other pedestrians and vehicles around (laging pagsasaalang-alang sa mga tumatawid sa kalsada at sa mga sasakyang nakapaligid)</label><br>
                <label><input type="radio" name="q16" value="c"> c. blowing one's horn every now and then to scare passers-by (maya't mayang pagbusina upang takutin ang mga naglalakad)</label><br>
            </div>
            <div class="question">
                <p>When the vehicle you are driving runs off the road or hits an electric post or a parked car, the most probable reason is: (Kapag ang minamaneho mong sasakyan ay lumihis sa kalsada o tumama sa poste ng kuryente o nakaparadang sasakyan, malamang na ang dahilan nito ay:)</p>
                <label><input type="radio" name="q17" value="a" data-correct="true"> a. you are driving too fast and you lost control of your vehicle (mabilis ang iyong pagpapatakbo at nawalan ka ng kontrol sa iyong sasakyan)</label><br>
                <label><input type="radio" name="q17" value="b"> b. you lost brake (nawalan ka ng preno)</label><br>
                <label><input type="radio" name="q17" value="c"> c. you are trying to overtake (mag-o-overtake ka sana)</label><br>
            </div>
            <div class="question">
                <p>If your vehicle broke down on the road, what should you do? (Kapag nasiraan ka ng sasakyan sa daan, ano ang gagawin mo?)</p>
                <label><input type="radio" name="q18" value="a"> a. Leave the vehicle and call for a mechanic (Iwan ang sasakyan at tumawag ka ng mekaniko)</label><br>
                <label><input type="radio" name="q18" value="b" data-correct="true"> b. Switch on the hazard warning lights and display an Early Warning Device (EWD) at least four (4) meters behind the stalled vehicle (Pailawin ang hazard warning light at maglagay ng EWD apat (4) na metro man lamang sa likuran ng nakahintong sasakyan)</label><br>
                <label><input type="radio" name="q18" value="c"> c. Turn off the engine and call for a mechanic (Patayin ang makina at tumawag ng mekaniko)</label><br>
            </div>
            <div class="question">
                <p>What is the primary responsibility of a driver in times of a road crash? (Ano ang pangunahing responsibilidad ng isang drayber sa isang aksidente?)</p>
                <label><input type="radio" name="q19" value="a" data-correct="true"> a. Aid the victim (Tulungan ang naaksidente)</label><br>
                <label><input type="radio" name="q19" value="b"> b. Run and hide (Tumakbo at magtago)</label><br>
                <label><input type="radio" name="q19" value="c"> c. Ask for victim's identification card (Tanungin ang mga biktima nang pagkakakilanlan)</label><br>
            </div>
            <div class="question">
                <p>Which of the following is a quality of a defensive driver? (Alin sa mga sumusunod ang kwalipikasyon ng isang maayos na drayber?)</p>
                <label><input type="radio" name="q20" value="a"> a. drivers who knows how to properly use clutch and brake pedals while driving (mga drayber na marunong gumamit ng clutch at preno habang nagmamaneho)</label><br>
                <label><input type="radio" name="q20" value="b" data-correct="true"> b. drivers that are using the basic knowledge of vehicle maintenance (Mga drayber na may kaalaman sa pagmintina ng sasakyan)</label><br>
                <label><input type="radio" name="q20" value="c"> c. driver who continues to drive even with flat tires to avoid an impounding ticket (Mga drayber na nagpapatuloy sa pagbiyahe kahit na flat ang gulong para maiwasang ma-impound)</label><br>
            </div>
            <div class="question">
                <p>Which one is correct road discipline? (Alin ang tamang disiplina sa kalsada?)</p>
                <label><input type="radio" name="q21" value="a"> a. hiding from traffic enforcers during oplan sita (magtago sa mga enforcers sa panahon ng oplan sita)</label><br>
                <label><input type="radio" name="q21" value="b"> b. following the advise of the elderly (Sundin ang mga payo ng mga matatanda)</label><br>
                <label><input type="radio" name="q21" value="c" data-correct="true"> c. knowing and abiding by the traffic rules and regulations (Alamin at sundin ang mga batas trapiko)</label><br>
            </div>
            <div class="question">
                <p>How can you overcome stress? (Paano mo malalampasan ang stress o tensyon?)</p>
                <label><input type="radio" name="q22" value="a"> a. stopping, getting out of the vehicle, shouting at anybody who inquires and then engaging in a fight (paghinto, pagbaba sa sasakyan, pagsigaw kahit kanino at maghamon ng away sa mga nagtatanong)</label><br>
                <label><input type="radio" name="q22" value="b" data-correct="true"> b. taking a deep breath, sitting comfortably, listening to soothing music, allowing enough space in front and providing extra travel time (Huminga ng malalim, maupo ng maayos, makinig sa mga nakakaaliw na tugtog, pagbigay nang tamang distansiya sa harap at pagbigay ng karagdagang oras sa biyahe)</label><br>
                <label><input type="radio" name="q22" value="c"> c. driving faster than allowed, listen to loud music, shouting at passengers and provoke other motorists to a fight (Pagmaneho nang mas mabilis, pagkinig sa maiingay na tugtog, pagsigaw sa mga iba pang motorista at paghamon ng away)</label><br>
            </div>
            <div class="question">
                <p>What may happen if a driver failed to overcome stress? (Ano ang maaaring mangyari kung ang isang drayber ay hindi malampasan ang stress o tensyon?)</p>
                <label><input type="radio" name="q23" value="a"> a. proper changing lanes (tamang paglipat ng lane o pwesto)</label><br>
                <label><input type="radio" name="q23" value="b"> b. smooth braking (Maayos na pagpreno)</label><br>
                <label><input type="radio" name="q23" value="c" data-correct="true"> c. road rage (Away sa kalsada)</label><br>
            </div>
            <div class="question">
                <p> of the following actions may result to road rage? (Alin sa mga sumusunod ang maaaring mag resulta sa away kalsada?)</p>
                <label><input type="radio" name="q24" value="a"> a. following a vehicle with enough space to maneuver (pagsunod sa isang sasakyan ng may tamang agwat)</label><br>
                <label><input type="radio" name="q24" value="b" data-correct="true"> b. cutting off other vehicles or following too close (Pag-cut sa ibang motorista at pagtutok sa mga ito)</label><br>
                <label><input type="radio" name="q24" value="c"> c. allowing other motorists to overtake with ease (Pagbigay daan sa mga motorista para makapag-overtake nang maayos)</label><br>
            </div>
            <div class="question">
                <p>What is the ultimate result of a road rage? (Ano ang pinakamasamang mangyayari sa isang away kalsada?)</p>
                <label><input type="radio" name="q25" value="a" data-correct="true"> a. Death (kamatayan)</label><br>
                <label><input type="radio" name="q25" value="b"> b. more friends (Mas maraming kaibigan)</label><br>
                <label><input type="radio" name="q25" value="c"> c. refreshment</label><br>
            </div>
            <div class="question">
                <p>If you feel drowsy while driving, it is important that you: (Kung nakakaramdam ka ng pagka-antok habang nagmamaneho, mahalaga na ikaw ay:)</p>
                <label><input type="radio" name="q26" value="a" data-correct="true"> a. park at a safe place, and take a short break before proceeding (magparada sa ligtas na lugar at magpahinga bago magpatuloy)</label><br>
                <label><input type="radio" name="q26" value="b"> b. speed up to reach your destination faster (bilisan ang takbo upang makarating ng mabilis sa destinasyon)</label><br>
                <label><input type="radio" name="q26" value="c"> c. stop driving, switch on the hazard lights and take a nap (huminto sa pagmamaneho, iswitch ang mga hazard lights at magpahinga)</label><br>
            </div>
            <div class="question">
                <p>Can a driver allow a cyclist to hitch on his vehicle? (Maaari bang pahintulutan ng drayber ang siklista na sumabit sa kanyang sasakyan?)</p>
                <label><input type="radio" name="q27" value="a"> a. No, especially without permission from an enforcer (Hindi, lalo at walang permiso sa traffic enforcer)</label><br>
                <label><input type="radio" name="q27" value="b"> b. No, road crash may happen (Hindi, maaaring magka-aksidente)</label><br>
                <label><input type="radio" name="q27" value="c" data-correct="true"> c. No (Hindi)</label><br>
            </div>
            <div class="question">
                <p>What is the first thing to do if you experience a tire blowout? (Ano ang una mong dapat gawin kung ikaw ay nakaranas ng tire blowout?)</p>
                <label><input type="radio" name="q28" value="a" data-correct="true"> a. Don't step on the brakes, focus on the steering wheel (huwag tapakan ang preno, at magpokus sa manibela)</label><br>
                <label><input type="radio" name="q28" value="b"> b. Step on your brakes immediately to avoid hitting the motor vehicle in front of you (agad na tapakan ang brakes upang maiwasan ang pagbangga sa mga sasakyan na nasa iyong harapan)</label><br>
                <label><input type="radio" name="q28" value="c"> c. Switch off the engine (patayin ang makina)</label><br>
            </div>
            <div class="question">
                <p>What is the main purpose of having a vehicle undergo regular vehicle maintenance inspection? (Ano ang pangunahing layunin ng regular na pag inspeksyon ng isang sasakyan?)</p>
                <label><input type="radio" name="q29" value="a"> a. to

 verify the chassis and engine numbers of the vehicle (Para siyasatin ang mga numero ng chassis at motor ng sasakyan)</label><br>
                <label><input type="radio" name="q29" value="b" data-correct="true"> b. to check the roadworthiness of the vehicle (Para tingnan ang kaayusan ng sasakyan)</label><br>
                <label><input type="radio" name="q29" value="c"> c. to check the driver's performance (Para tingnan ang pagganap ng drayber sa kanyang pagmamaneho)</label><br>
            </div>
            <div class="question">
                <p> do you need to follow the traffic rules and regulations? (Kailan mo dapat sundin ang mga batas trapiko?)</p>
                <label><input type="radio" name="q30" value="a"> a. when avoiding an enforcer (Kung umiiwas sa isang enforcer)</label><br>
                <label><input type="radio" name="q30" value="b"> b. when parked (Habang nagpaparada)</label><br>
                <label><input type="radio" name="q30" value="c" data-correct="true"> c. while at the steering wheel (Habang nasa manibela)</label><br>
            </div>
            <button type="button" onclick="submitTest2()">Submit Test</button>
            <div id="results" class="results"></div>
        </form>
        <div class="navigation">
            <button onclick="goToDashboard()" class="dashboard-button">Back to Dashboard</button>
            <button onclick="markAsCompleted(6, 7)" class="complete-button">Mark as Completed</button>
            <button onclick="retryTest()" class="retry-button" style="display:none;">Retry</button>
            <!-- <a href="defensive_driving.html" class="next-button">Next Lesson: Defensive Driving</a> -->
        </div>
    </div>
    <script src="../assets/scripts/test2.js"></script>
    <script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("testForm");
  const questions = Array.from(form.querySelectorAll(".question"));
  const submitBtn = document.querySelector("button[onclick^='submitTest']");
  const completeBtn = document.querySelector(".complete-button");
  const resultBox = document.getElementById("results");
  const total = questions.length;
  const passingScore = Math.ceil(total * 0.8); // 80%

  // Move submit button to bottom
  const nav = document.querySelector(".navigation");
  nav.appendChild(submitBtn);

  // Randomize question order
   questions.sort(() => Math.random() - 0.5);
   questions.forEach(q => form.insertBefore(q, resultBox));

  // Timer setup (30 minutes)
  let time = 30 * 60;
  const timerDiv = document.createElement("div");
  timerDiv.id = "exam-timer";
  timerDiv.style = "position: absolute; top: 20px; left: 20px; font-weight: bold; color: red;";
  document.querySelector(".test-container").prepend(timerDiv);

  const timerInterval = setInterval(() => {
    const mins = String(Math.floor(time / 60)).padStart(2, "0");
    const secs = String(time % 60).padStart(2, "0");
    timerDiv.textContent = `⏳ Time Left: ${mins}:${secs}`;
    if (time <= 0) {
      clearInterval(timerInterval);
      submitTest();
    }
    time--;
  }, 1000);

  // Submit Test function
  window.submitTest1 = window.submitTest2 = submitTest;

function submitTest() {
  // Check if all questions have been answered
  let allAnswered = true;
  questions.forEach(q => {
    const selected = q.querySelector("input:checked");
    if (!selected) {
      allAnswered = false;
      q.style.border = "2px solid red"; // highlight unanswered
    } else {
      q.style.border = "none"; // remove highlight if answered
    }
  });

  if (!allAnswered) {
    alert("❗ Please answer all questions before submitting.");
    return; // stop submission
  }

  clearInterval(timerInterval);
  let correct = 0;

  questions.forEach(q => {
    const selected = q.querySelector("input:checked");
    if (selected?.dataset.correct === "true") correct++;
  });

  // Disable inputs and buttons
  form.querySelectorAll("input").forEach(el => el.disabled = true);
  form.querySelectorAll("button").forEach(btn => {
    if (!btn.classList.contains("dashboard-button")) {
      btn.disabled = true;
    }
  });

  const percentage = Math.round((correct / total) * 100);

  // Send score to the server
  fetch("../api/save_test_score_test2.php", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: `test_score=${correct}`
})
.then(response => {
    if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
    }
    return response.json();
})
.then(data => {
    if (data.success) {
        console.log("Score saved successfully:", correct);
    } else {
        console.error("Error saving score:", data.message);
        alert("Failed to save score: " + data.message);
    }
})
.catch(err => {
    console.error("Network error details:", err);
    alert(`Failed to save score due to a network error: ${err.message}`);
});

  resultBox.innerHTML = `
    <h3>📝 You got ${correct}/${total} correct (${percentage}%)</h3>
    <p style="color: ${correct >= passingScore ? 'green' : 'red'};">
      ${correct >= passingScore ? '✅ Congratulations! You passed.' : '❌ You did not reach the passing score of 80%.'}
    </p>
  `;

  completeBtn.disabled = correct < passingScore;

  const retryBtn = document.querySelector(".retry-button");
  retryBtn.style.display = "inline-block";
  retryBtn.onclick = () => location.reload();
}


  completeBtn.disabled = true;
});

  // Goes back to dashboard
  function goToDashboard() {
    window.location.href = "student.html";
  }

  // Save progress and redirect with 1-day waiting period
  function markAsCompleted(currentLessonId, nextLessonId) {
    const completionTimeKey = `lesson_${currentLessonId}_completion_time`;
    const now = Date.now();
    const oneDayInMs = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

    // Check if already completed and waiting period is still active
    const completionTime = localStorage.getItem(completionTimeKey);
    if (completionTime) {
      const timeElapsed = now - parseInt(completionTime);
      const timeRemaining = oneDayInMs - timeElapsed;
      if (timeRemaining > 0) {
        const hoursRemaining = Math.ceil(timeRemaining / (60 * 60 * 1000));
        alert(`You must wait ${hoursRemaining} hour(s) before accessing the next lesson.`);
        return;
      }
    }

    // Save completion time if not already saved
    if (!completionTime) {
      localStorage.setItem(completionTimeKey, now.toString());
    }

    // Proceed with saving progress to server
    fetch("../api/save_progress.php", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: `lesson_id=${currentLessonId}&completion_percentage=100`
    })
    .then(() => {
      alert("Marked as completed! You can access the next lesson after 24 hours.");
      window.location.href = "student.html";
    })
    .catch(err => {
      console.error("Error saving progress:", err);
      alert("Failed to mark as completed.");
    });
  }
    </script>
</body>
</html>